<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/css/reveal.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/css/theme/solarized.css" />

    <style>
        .reveal h1,
        .reveal h2,
        .reveal h3,
        .reveal h4,
        .reveal h5,
        .reveal h6 {
            margin: 0 0 20px 0;
            font-family: "Source Sans Pro", Helvetica, sans-serif;
            font-weight: 600;
            line-height: 1.2;
            letter-spacing: normal;
            text-transform: none;
            text-shadow: none;
            word-wrap: break-word; 
        }

        .gist-meta {
            display: none !important;
        }

        .code-title {
            font-family: monospace !important;
            background: #dddddd;
            color: #7b5ab8;
        }

        .strike {
            text-decoration: line-through;
        }
    </style>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <h2><pre> Kotlin, Practically Speaking</pre></h2>
            </section>
            <section>
                <h3>Who am I?</h3>
                <h4>Andrew Watson</h4>
                <h4>Senior Android developer @ Microsoft - Yammer team</h4>
                <h4>üê£: @creativedrewy</h4>
            </section>
            <section>
                <h3>Who are you?</h3>
            </section>
            <section>
                <h3>What I'm going to talk about</h3>
                <h4>We've been using Kotlin for 1¬Ω years, and it's great!</h4>
                <ul>
                    <li>The path we took to get started</li>
                    <li>Practical lessons we've learned along the way</li>
                    <li>Particularly re: migrating and converting an existing codebase</li>
                </ul>
            </section>
            <section>
                <h3>Getting the party started at Yammer</h3>
            </section>
            <section>
                <h3>May, 2017</h3>
                <ul>
                    <li>Personally I had been using "not-official" Kotlin since 2015</li>
                    <li>I/O 2017: Google FTW!</li>
                    <li>Our team was understandably mixed</li>
                </ul>
            </section>
            <section>
                <h3>Taking our time</h3>
                <ul>
                    <li>Didn't make anyone do Kotlin right away</li>
                    <li>Book club for 6 months</li>
                    <li>"Kotlin in Action" by Jemerov and Isakova</li>
                    <li>We didn't outright block the usage of it though</li>
                </ul>
            </section>
            <section>
                <h3>Our next steps</h3>
                <ul>
                    <li>Wrote a draft of Kotlin coding standards</li>
                    <li>Converting unit/Espresso tests was good practice</li>
                    <li>Eventually: all new code to be written in Kotlin</li>
                </ul>
            </section>
            <section>
                <h3>A word on buy-in from higher-ups</h3>
                <ul>
                    <li>Thankfully we had the freedom to do this</li>
                    <li>I can tell you intuitively things are better</li>
                    <li>Official metrics would be very nice</li>
                    <li>Maybe this talk could help you get buy in!</li>
                </ul>
            </section>
            <section>
                <h3>Things we've learned</h3>
                <iframe src="https://giphy.com/embed/IPbS5R4fSUl5S" width="480" height="266" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/IPbS5R4fSUl5S"></a></p>
            </section>
            <section>
                <h3>Lesson:</h3>
                <h3>The auto-converter leaves work for you to do ü§∑‚Äç</h3>
                <h6>An example:</h6>
            </section>
            <section>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=JavaActivity.java"></script>
            </section>
            <section>
                <h3>The initial conversion</h3>
            </section>
            <section>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=KotlinActivityDefault.kt"></script>
            </section>
            <section>
                <h3>We can do better</h3>
            </section>
            <section>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=KotlinActivityBetter.kt"></script>
            </section>
            <section>
                <h3>A word about Companion Objects</h3>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=CompanionSlide1.java"></script>
            </section>
            <section>
                <h6>Converted:</h6>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=CompanionSlide2a.kt"></script>
                <h6>Consumed in Java:</h6>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=CompanionSlide2b.java"></script>
            </section>
            <section>
                <h6>The right way:</h6>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=CompanionSlide3a.kt"></script>
                <h6>New consumption:</h6>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=CompanionSlide3b.java"></script>
            </section>
            <section>
                <h3>Lesson:</h3>
                <h3>Kotlin conversion will wipe all Git history üôÄ</h3>
            </section>
            <section>
                <h3>A beautiful history...</h3>
                <img src="images/git1.png" />
            </section>
            <section>
                <h3>Gone in an instant!</h3>
                <img src="images/git2.png" />
            </section>
            <section>
                <h3>This is actually due to the way Git works</h3>
                <h4>Not the auto-converter's fault</h4>
            </section>
            <section>
                <h3>So how do we actually do this?</h3>
                <ol>
                    <li>Do an initial auto Kotlin conversion</li>
                    <li>Clean up all the auto convert issues</li>
                    <li>Copy the converted contents to a scratch file</li>
                    <li>Revert your changes</li>
                    <li>Rename **just** the file name to *.kt</li>
                    <li>Commit! Your build is mega broken.</li>
                    <li>Paste in your converted Kotlin code</li>
                    <li>Commit a 2nd time. Now you are converted!</li>
                </ol>
            </section>
            <section>
                <h3>Plz don't squash!</h3>
                <img src="images/git3.png" />
            </section>
            <section>
                <h3>Lesson:</h3>
                <h3>Your custom lint rules don't apply here</h3>
                <h4>(But probably need reviewing anyway)</h4>
            </section>
            <section>
                <h3>Goodbye <span class="code-title">JavaScanner</span>, hello <span class="code-title strike">UastScanner</span></h3>
                <h4>Just kidding: <span class="code-title">Detector(), SourceCodeScanner</span></h4>
                <h4>Dev Summit Talk: <a href="https://youtu.be/ffH-LD5uP4s" target="_blank">https://youtu.be/ffH-LD5uP4s</a></h4>
            </section>
            <section>
                <h3>Lesson:</h3>
                <h3>No really, don't use !!</h3>
                <ul>
                    <li>Don't follow the auto-converter's example</li>
                    <li>With rare exeception, if you're using !!, you're doing it wrong</li>
                    <li>Short-circuits Kotlin's nullability features</li>
                    <li>Our PR rule: If there's a !!, explain yourself!</li>
                </ul>
            </section>
            <section>
                <h3>Lesson:</h3>
                <h3>Your Kotlin files can share a üè° with your Java files</h3>
                <ul>
                    <li>Initially we created two src dirs - java/ and kotlin/</li>
                    <li>Made conversion painful - had to recreate directory structures</li>
                    <li>After a while, we were totally comfortable with .java and .kt side-by-side</li>
                </ul>
            </section>
            <section>
                <h3>Lesson:</h3>
                <h3>Some files just can't be converted</h3>
                <ul>
                    <li>The older the file, the more likely you can't convert</li>
                    <li>Base classes (protected fields,¬†getters/setters, etc)</li>
                    <li>Assumptions about nullability and/or using null as data "state"</li>
                </ul>
            </section>
            <section>
                <h3>Lesson:</h3>
                <h3>Death to Utils! Death to Helpers!</h3>
            </section>
            <section>
                <h3>Long live Extensions!</h3>
                <h4>Organize by class type</h4>
                <img src="images/extensions.png" />
            </section>
            <section>
                <h3>Oh and functions too. Just, functions.</h3>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=PackageFunction.kt"></script>
            </section>
            <section>
                <h3>Lesson:</h3>
                <h4>Evolve your coding standards</h4>
                <ul>
                    <li>Usage of "it"</li>
                    <li>Declaring type when we really didn't need to</li>
                </ul>
            </section>
            <section>
                <h3>You really can start thinking different! Better!</h3>
                <script src="https://gist.github.com/creativedrewy/679bb311b19142af271531ebfcb838dd.js?file=ChainExample.kt"></script>
            </section>
            <section>
                <h3>Thanks!</h3>
            </section>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/js/reveal.js"></script>

    <script>
        Reveal.initialize();
    </script>
</body>

</html>